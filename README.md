<!--

NOTICE: THIS FILE IS AUTOGENERATED FROM docs/README.template.md

This file is evaled by a quickly cobbled together bash script to replace the variables.

Backticks are imterpreted by bash so use <code> for inline code and <pre> for code blocks.

If you need to include bsah code snippets you will need to change how the templating works.

-->

# Simulator

A distributed systems and infrastructure simulator for attacking and debugging Kubernetes

## Usage

The quickest way to get up and running is to simply:

<pre>
make run
</pre>

This will drop you into a bash shell in a launch container.  You will have a program on the <code>PATH</code> named <code>simulator</code>
to interact with.

### [Simulator CLI Usage](./docs/cli.md)

### tldr;

<pre>
# Create the infra if it isn't there
simulator infra create
# Configure your SSH to perturb the cluster
simulator ssh config --write
# Launch a scenario (runs perturb.sh)
simulator scenario launch database_compromise
# Attack the cluster
simulator ssh attack
</pre>

## SSH Keys

If using with <code>make run</code> the default RSA keypair on your host machine (I.E. <code>~/.ssh/id_rsa{,.pub}</code> will
be setup as an authorised key on the infrastructure. If your key has a passphrase (it should :)) then you
will need to make sure you have <code>ssh-add</code>ed to SSH agent.  The SSH agent sock is mounted in the container
and SSH is configured to use it.

## Development Workflow

Development targets are specified in the [Makefile](./Makefile).

<pre>
run: SSH_AUTH_SOCK_DIR=$(shell dirname $(SSH_AUTH_SOCK))
run                   Runs the simulator - the build stage of the container runs all the cli tests
docker-build          Builds the launch container
docker-test           Run the tests
infra-init            Initialisation needed before interacting with the infra
infra-checkvars       Check the tfvars file exists before interacting with the infra
infra-plan            Show what changes will be applied to the infrastructure
infra-apply           Apply any changes needed to the infrastructure before running a scenario
infra-destroy         Teardown any infrastructure
dep                   Install dependencies for other targets
build                 Run golang build for the CLI program
test                  run all tests except goss tests
test-acceptance       Run bats acceptance tests for the CLI program
test-unit             Run golang unit tests for the CLI program
coverage              Run golang unit tests with coverage and opens a browser with the results
doc                   Generate documentation
</pre>

## Architecture

### [Launching a scenario](./docs/launch.md)

### *TODO* [Validating a scenario](./docs/validation.md)

### *TODO* [Evaluating  scenario progress](./docs/evaluation.md)

### Components

* [Simulator CLI tool](./cmd) - Runs in the launch container and orchestrates everything
* [Launch container](./Dockerfile) - Isolates the scripts from the host
* [Terraform Scripts for infrastructure provisioning](./terraform) - AWS infra
* [Perturb.sh](./simulation-scripts/perturb.sh) - sets up a scenario on a cluster
* [Scenarios](./simulation-scripts/scenario)
* [Attack container](./attack) - Runs on the bastion providing all the tools needed to attack a
cluster in the given cloud provider

### Simulator API Documentation

* [Scenario](./docs/api/scenario.md)
* [Simulator](./docs/api/simulator.md)
* [Util](./docs/api/util.md)

## Project Roadmap

There is a [roadmap](./docs/roadmap.md) outlining current and planned work.
